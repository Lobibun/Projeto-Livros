@model List<LivroCDF.Controllers.UsuarioViewModel>

<div class="table-responsive">
    <table class="table table-hover align-middle mb-0 bg-white">
        <thead class="bg-light border-bottom">
            <tr>
                <th class="ps-4 py-3 text-secondary text-uppercase small">Usuário</th>
                <th class="py-3 text-secondary text-uppercase small d-none d-md-table-cell">Nível de Acesso</th>
                <th class="py-3 text-end pe-4 text-secondary text-uppercase small">Ações</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                @foreach (var user in Model)
                {
                    <tr>
                        <td class="ps-4 py-3">
                            <div class="d-flex align-items-center">
                                <div class="me-3 position-relative">
                                    @if (!string.IsNullOrEmpty(user.FotoCaminho))
                                    {
                                        <img src="@user.FotoCaminho" class="rounded-circle shadow-sm object-fit-cover" style="width: 48px; height: 48px;" alt="Foto" />
                                    }
                                    else
                                    {
                                        <div class="rounded-circle bg-primary bg-gradient text-white d-flex align-items-center justify-content-center shadow-sm" style="width: 48px; height: 48px; font-size: 18px; font-weight: bold;">
                                            @(string.IsNullOrEmpty(user.Nome) ? user.Email.Substring(0, 1).ToUpper() : user.Nome.Substring(0, 1).ToUpper())
                                        </div>
                                    }
                                </div>

                                <div>
                                    @if (!string.IsNullOrEmpty(user.Nome))
                                    {
                                        <div class="fw-bold text-dark">@user.Nome</div>
                                        <div class="small text-muted text-break" style="max-width: 200px;">@user.Email</div>
                                    }
                                    else
                                    {
                                        <div class="fw-bold text-dark text-break" style="max-width: 200px;">@user.Email</div>
                                    }

                                    <div class="d-md-none mt-2">
                                        @foreach (var role in user.Roles)
                                        {
                                            if (role == "SuperAdmin")
                                            {
                                                <span class="badge bg-dark bg-gradient rounded-pill"><i class="bi bi-stars text-warning me-1"></i> CEO</span>
                                            }
                                            else if (role == "Admin")
                                            {

                                                <span class="badge bg-primary bg-gradient rounded-pill"><i class="bi bi-shield-lock me-1"></i> GERENTE</span>
                                            }
                                            else
                                            {

                                                <span class="badge bg-secondary bg-opacity-10 text-secondary border">Básico</span>
                                            }
                                        }
                                    </div>
                                </div>
                            </div>
                        </td>

                        <td class="d-none d-md-table-cell">
                            @foreach (var role in user.Roles)
                            {
                                if (role == "SuperAdmin")
                                {
                                    <span class="badge bg-dark bg-gradient rounded-pill px-3 py-2 shadow-sm"><i class="bi bi-stars text-warning me-1"></i> CEO / Admin</span>
                                }
                                else if (role == "Admin")
                                {

                                    <span class="badge bg-primary bg-gradient rounded-pill px-3 py-2 shadow-sm"><i class="bi bi-shield-lock me-1"></i> GERENTE</span>
                                }
                                else
                                {

                                    <span class="badge bg-secondary bg-opacity-10 text-secondary border px-3 py-2"><i class="bi bi-person me-1"></i> Básico</span>
                                }
                            }
                        </td>

                        <td class="text-end pe-4">
                            @if (User.IsInRole("SuperAdmin"))
                            {
                                <div class="d-flex justify-content-end gap-1">
                                    @if (!user.Roles.Contains("Admin") && !user.Roles.Contains("SuperAdmin"))
                                    {
                                        <form asp-action="TornarAdmin" asp-route-userId="@user.UserId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-success border-0" title="Promover">
                                                <i class="bi bi-arrow-up-circle fs-5"></i>
                                            </button>
                                        </form>
                                    }
                                    else if (user.Roles.Contains("Admin"))
                                    {
                                        <form asp-action="RebaixarParaComum" asp-route-userId="@user.UserId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-secondary border-0" title="Rebaixar">
                                                <i class="bi bi-arrow-down-circle fs-5"></i>
                                            </button>
                                        </form>
                                    }

                                    @if (!user.Roles.Contains("SuperAdmin"))
                                    {
                                        <form asp-action="ResetarSenha" asp-route-userId="@user.UserId" method="post" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-outline-warning border-0" title="Resetar Senha" onclick="return confirm('A senha será resetada. Confirmar?');">
                                                <i class="bi bi-key fs-5"></i>
                                            </button>
                                        </form>
                                    }

                                    <button type="button" class="btn btn-sm btn-outline-danger border-0" data-bs-toggle="modal" data-bs-target="#deleteModal-@user.UserId" title="Excluir">
                                        <i class="bi bi-trash fs-5"></i>
                                    </button>
                                </div>

                                <div class="modal fade" id="deleteModal-@user.UserId" tabindex="-1" aria-hidden="true">
                                    <div class="modal-dialog modal-dialog-centered">
                                        <div class="modal-content border-0 shadow">
                                            <div class="modal-header bg-danger text-white">
                                                <h5 class="modal-title">Excluir Usuário</h5>
                                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body text-center py-4">
                                                <p>Remover acesso de <strong>@user.Email</strong>?</p>
                                                <form asp-action="Excluir" asp-route-userId="@user.UserId" method="post">
                                                    <button type="submit" class="btn btn-danger w-100 mt-2">Confirmar</button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td colspan="3" class="text-center py-5 text-muted">Nenhum usuário encontrado.</td></tr>
            }
        </tbody>
    </table>
</div>