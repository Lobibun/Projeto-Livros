@model List<LivroCDF.Controllers.UsuarioViewModel>

@{
    ViewData["Title"] = "Gerenciar Usuários";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2><i class="bi bi-people-fill"></i> Controle de Usuários</h2>
    </div>

    @if (TempData["Erro"] != null)
    {
        <div class="alert alert-danger shadow-sm">@TempData["Erro"]</div>
    }
    @if (TempData["Sucesso"] != null)
    {
        <div class="alert alert-success shadow-sm">@TempData["Sucesso"]</div>
    }

    <div class="card p-3 mb-3 bg-light shadow-sm">
        <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
                <i class="bi bi-search text-muted"></i>
            </span>
            <input type="text" id="txtPesquisaUsuario" class="form-control border-start-0"
                   placeholder="Pesquisar por nome ou email..." autocomplete="off" />
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body p-0" id="containerTabelaUsuarios">
            <partial name="_TabelaUsuarios" model="Model" />
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            let timeout = null;

            $("#txtPesquisaUsuario").on("keyup", function () {
                var valor = $(this).val();

                // Limpa o timer anterior para não buscar a cada letra digitada muito rápido
                clearTimeout(timeout);

                // Espera 300 milissegundos após parar de digitar
                timeout = setTimeout(function () {
                    buscarUsuarios(valor);
                }, 300);
            });
        });

        function buscarUsuarios(termo) {
            $("#containerTabelaUsuarios").css("opacity", "0.5"); // Efeito visual de carregando

            $.ajax({
                url: '/Usuarios/FiltrarUsuarios', // Chama seu Controller
                type: 'GET',
                data: { termo: termo },
                success: function (html) {
                    $("#containerTabelaUsuarios").html(html);
                    $("#containerTabelaUsuarios").css("opacity", "1");
                },
                error: function () {
                    alert("Erro ao filtrar usuários.");
                    $("#containerTabelaUsuarios").css("opacity", "1");
                }
            });
        }
    </script>
}