@model List<LivroCDF.Controllers.UsuarioViewModel>
@{
    ViewData["Title"] = "Gerenciar Usuários";
}

<div class="container-fluid container-md mt-4 mt-md-5">

    <div class="row mb-4 align-items-end">
        <div class="col-12">
            <h6 class="text-uppercase text-muted fw-bold small">Administração</h6>
            <h2 class="fw-bold text-dark d-flex align-items-center">
                <i class="bi bi-people-fill text-primary me-2"></i> Controle de Usuários
            </h2>
        </div>
    </div>

    @if (TempData["Erro"] != null)
    {
        <div class="alert alert-danger shadow-sm border-0 d-flex align-items-center mb-4">
            <i class="bi bi-x-circle-fill fs-4 me-3"></i> <div>@TempData["Erro"]</div>
        </div>
    }
    @if (TempData["Sucesso"] != null)
    {
        <div class="alert alert-success shadow-sm border-0 d-flex align-items-center mb-4">
            <i class="bi bi-check-circle-fill fs-4 me-3"></i> <div>@TempData["Sucesso"]</div>
        </div>
    }

    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-2">
            <div class="input-group input-group-lg">
                <span class="input-group-text bg-white border-0 ps-3">
                    <i class="bi bi-search text-primary"></i>
                </span>
                <input type="text" id="txtPesquisaUsuario" class="form-control border-0 fs-6 fs-md-5"
                       placeholder="Pesquisar por nome ou email..." autocomplete="off" style="box-shadow: none;">
            </div>
        </div>
    </div>

    <div class="card border-0 shadow-sm overflow-hidden">
        <div class="card-body p-0" id="containerTabelaUsuarios" style="transition: opacity 0.3s ease;">
            <partial name="_TabelaUsuarios" model="Model" />
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            let timeout = null;
            $("#txtPesquisaUsuario").on("keyup", function () {
                var valor = $(this).val();
                clearTimeout(timeout);
                timeout = setTimeout(function () { buscarUsuarios(valor); }, 300);
            });
        });

        function buscarUsuarios(termo) {
            $("#containerTabelaUsuarios").css("opacity", "0.4");
            $.ajax({
                url: '/Usuarios/FiltrarUsuarios', type: 'GET', data: { termo: termo },
                success: function (html) {
                    $("#containerTabelaUsuarios").html(html);
                    $("#containerTabelaUsuarios").css("opacity", "1");
                },
                error: function () {
                    alert("Erro ao filtrar.");
                    $("#containerTabelaUsuarios").css("opacity", "1");
                }
            });
        }
    </script>
}