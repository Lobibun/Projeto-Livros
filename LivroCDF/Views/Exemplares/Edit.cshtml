@model LivroCDF.Models.Exemplar
@using LivroCDF.Models.Enums

@{
    ViewData["Title"] = "Gerenciar Exemplar";
}

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />

<div class="container py-4">
    <div class="card shadow-sm border-0">
        <div class="card-body p-3 p-md-4">
            <div class="d-flex flex-column flex-sm-row align-items-center mb-4 pb-3 border-bottom text-center text-sm-start">

                <div class="mb-3 mb-sm-0">
                    @if (Model.Livro != null && !string.IsNullOrEmpty(Model.Livro.FotoCaminho))
                    {
                        <img src="@Model.Livro.FotoCaminho" class="rounded me-sm-3 shadow-sm" style="height: 100px; width: 70px; object-fit: cover;" />
                    }
                    else
                    {
                        <div class="bg-secondary text-white d-flex align-items-center justify-content-center rounded me-sm-3 mx-auto" style="height: 100px; width: 70px;">
                            <i class="bi bi-book fs-3"></i>
                        </div>
                    }
                </div>

                <div>
                    <h5 class="text-muted mb-1">Gerenciar Exemplar #@Model.Id</h5>
                    <h2 class="mb-0 text-primary fs-3">@ViewBag.TituloLivro</h2>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6">
                    <form asp-controller="Exemplares" asp-action="Edit">
                        <input type="hidden" asp-for="Id" />
                        <input type="hidden" asp-for="LivroId" />

                        <div class="mb-3">
                            <label asp-for="Status" class="form-label fw-bold">Situação Atual</label>
                            <select asp-for="Status" id="ddlStatus" class="form-select" asp-items="Html.GetEnumSelectList<StatusLivro>()"></select>
                        </div>

                        <div class="mb-3 p-3 border border-warning rounded bg-warning bg-opacity-10" id="divCliente" style="display:none;">
                            <label asp-for="ClienteId" class="form-label fw-bold text-dark"><i class="bi bi-person-check-fill"></i> Cliente (Comprador)</label>
                            <select asp-for="ClienteId" id="ddlCliente" class="form-select" asp-items="ViewBag.ClienteId">
                                <option value="">-- Pesquise o Cliente --</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Valor" class="form-label fw-bold">Valor Real (R$)</label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input asp-for="Valor" class="form-control" type="number" step="0.01" />
                            </div>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-12 col-md-6">
                                <label asp-for="DataEntrada" class="form-label fw-bold text-muted">Data Entrada</label>
                                <input asp-for="DataEntrada" class="form-control bg-light" type="datetime-local" readonly
                                       value="@Model.DataEntrada.ToString("yyyy-MM-ddTHH:mm")" />
                            </div>
                            <div class="col-12 col-md-6">
                                <label asp-for="DataVenda" class="form-label fw-bold">Data Venda</label>
                                <input asp-for="DataVenda" class="form-control" type="datetime-local"
                                       value="@(Model.DataVenda?.ToString("yyyy-MM-ddTHH:mm"))" />
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex">
                            <input type="submit" value="Salvar Alterações" class="btn btn-primary px-4" />
                            <a asp-action="Index" class="btn btn-outline-secondary px-4">Cancelar</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function() {
            $('#ddlCliente').select2({
                theme: 'bootstrap-5',
                placeholder: "Selecione o Cliente...",
                allowClear: true,
                width: '100%'
            });

            $('#ddlStatus').change(function() {
                verificarStatus();
            });

            verificarStatus();
        });

        function verificarStatus() {
            var texto = $("#ddlStatus option:selected").text();

            if (texto === "Vendido" || texto === "A Pagar") {
                $("#divCliente").slideDown();
            } else {
                $("#divCliente").slideUp();
            }
        }
    </script>
}