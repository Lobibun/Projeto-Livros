@using LivroCDF.Models.Enums
@model IEnumerable<LivroCDF.Models.Cliente>

<div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th class="ps-4">Foto</th>
                <th>@Html.DisplayNameFor(model => model.Nome)</th>
                <th>@Html.DisplayNameFor(model => model.Email)</th>
                <th>Telefone</th>
                <th>Data Cadastro</th>
                <th class="text-end pe-4">Ações</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Any())
            {
                <tr>
                    <td colspan="6" class="text-center text-muted py-4">
                        <div class="alert alert-info mb-0">Nenhum cliente encontrado.</div>
                    </td>
                </tr>
            }
            else
            {
                @foreach (var item in Model)
                {
                    // --- LÓGICA VISUAL (A SUA LÓGICA ORIGINAL) ---
                    // Verifica se o cliente tem ALGUM exemplar com status 'A Pagar'
                    bool temPendencia = item.Compras != null && item.Compras.Any(c => c.Status == StatusLivro.APagar);

                    // Se tiver pendência, aplica a classe de aviso (amarelo claro)
                    string classeLinha = temPendencia ? "table-warning" : "";
                    // ---------------------------------------------

                    <tr class="@classeLinha">

                        <td class="ps-4">
                            @if (!string.IsNullOrEmpty(item.FotoCaminho))
                            {
                                <img src="@item.FotoCaminho" class="rounded-circle border border-2 border-white shadow-sm"
                                     style="width: 45px; height: 45px; object-fit: cover;" />
                            }
                            else
                            {
                                <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center shadow-sm"
                                     style="width: 45px; height: 45px; font-size: 18px; font-weight: bold;">
                                    @(string.IsNullOrEmpty(item.Nome) ? "?" : item.Nome.Substring(0, 1).ToUpper())
                                </div>
                            }
                        </td>

                        <td>
                            <span class="fw-bold">@Html.DisplayFor(modelItem => item.Nome)</span>

                            @* Se tiver pendência, mostra o aviso *@
                            @if (temPendencia)
                            {
                                <span class="badge bg-danger text-white ms-2" title="Este cliente possui débitos pendentes (A Pagar)">
                                    <i class="bi bi-exclamation-triangle-fill"></i> A Pagar
                                </span>
                            }
                        </td>

                        <td>@Html.DisplayFor(modelItem => item.Email)</td>

                        <td>@Html.DisplayFor(modelItem => item.Telefone)</td>

                        <td>@item.DataCadastro.ToString("dd/MM/yyyy")</td>

                        <td class="text-end pe-4">
                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-warning" title="Editar">
                                <i class="bi bi-pencil-square"></i> Editar
                            </a>
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info text-white" title="Detalhes">
                                <i class="bi bi-eye-fill"></i> Detalhes
                            </a>
                            <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-danger" title="Excluir">
                                <i class="bi bi-trash-fill"></i> Excluir
                            </a>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>
</div>