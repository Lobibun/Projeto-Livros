@model IEnumerable<LivroCDF.Models.LogAuditoria>

@if (!Model.Any())
{
    <tr>
        <td colspan="4" class="text-center py-5 text-muted">
            <i class="bi bi-inbox display-6 opacity-25"></i>
            <p class="mt-2">Nenhum registro encontrado.</p>
        </td>
    </tr>
}

@foreach (var item in Model)
{
    // --- LAYOUT DESKTOP (Tabela Normal) ---
    <tr class="d-none d-md-table-row">
        <td class="ps-4 text-nowrap text-muted">
            <i class="bi bi-calendar3 me-1"></i> @item.DataAcao.ToString("dd/MM/yyyy")
            <small class="ms-1">@item.DataAcao.ToString("HH:mm")</small>
        </td>
        <td>
            <div class="d-flex align-items-center">
                <div class="bg-light rounded-circle p-2 me-2 text-primary">
                    <i class="bi bi-person-fill"></i>
                </div>
                <span class="fw-medium">@item.Usuario</span>
            </div>
        </td>
        <td>
            @RenderBadge(item.Acao)
        </td>
        <td class="text-muted small text-break">@item.Detalhes</td>
    </tr>

    <tr class="d-md-none">
        <td colspan="4" class="p-3 border-bottom">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="text-muted small">
                    <i class="bi bi-clock"></i> @item.DataAcao.ToString("dd/MM HH:mm")
                </span>
                @RenderBadge(item.Acao)
            </div>

            <div class="d-flex align-items-center mb-2">
                <i class="bi bi-person-circle text-secondary me-2"></i>
                <span class="fw-bold text-dark">@item.Usuario</span>
            </div>

            <div class="bg-light p-2 rounded small text-secondary border">
                <i class="bi bi-info-circle me-1"></i> @item.Detalhes
            </div>
        </td>
    </tr>
}

@functions {
    public Microsoft.AspNetCore.Html.IHtmlContent RenderBadge(string acao)
    {
        string color = "secondary";
        string icon = "bi-circle";

        if (acao.Contains("Venda")) { color = "success"; icon = "bi-cart-check"; }
        else if (acao.Contains("Exclusão") || acao.Contains("Remover")) { color = "danger"; icon = "bi-trash"; }
        else if (acao.Contains("Entrada") || acao.Contains("Novo")) { color = "primary"; icon = "bi-plus-circle"; }
        else if (acao.Contains("Edição")) { color = "warning"; icon = "bi-pencil"; }

        var html = $"<span class='badge rounded-pill bg-{color} bg-opacity-10 text-{color} border border-{color} px-2'>" +
                   $"<i class='bi {icon} me-1'></i> {acao}</span>";
        return Html.Raw(html);
    }
}